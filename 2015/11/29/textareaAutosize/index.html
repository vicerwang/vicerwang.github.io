<!DOCTYPE html><html lang="zh-cn"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> 让textarea高度随输入自适应 · Vic's Posts</title><meta name="description" content="让textarea高度随输入自适应 - vic"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="short icon" href="/"><link rel="stylesheet" href="/css/apollo.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,600" type="text/css"></head><body><header><a href="/" class="logo-link"><img src="/avatar.jpg"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="https://github.com/vicerwang" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="https://www.zhihu.com/people/wang-jin-liang-69" target="_blank" class="nav-list-link">ZHIHU</a></li></ul></header><section class="container"><div class="post"><article class="post-block"><h1 class="post-title">让textarea高度随输入自适应</h1><div class="post-meta"><div class="post-time">2015年11月29日</div></div><div class="post-content"><p>让一个可编辑的div实现高度随输入自适应，很简单，只要设置下它的<code>min-height</code>就好了：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">div</span> <span class="attribute">contenteditable</span>=<span class="value">"true"</span> <span class="attribute">style</span>=<span class="value">"width:200px;min-height:100px;border:1px solid #e8e8e8"</span> &gt;</span><span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>显然这招放在textarea上并不怎么管用，那么如何让一个textarea也做到像div一样的伸缩自如呢？</p>
<a id="more"></a>
<p>下面我将介绍3种通过js实现的方法，但是他们都依赖于对输入事件的监听，由于浏览器对其的支持不一，我曾在上一篇<a href="http://fedvic.com/2015/11/29/textChange/">博文</a>中专门讨论过这个问题，这里就不在赘述，直接拿出封装好的方法：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> bindTextChange = <span class="function"><span class="keyword">function</span> (<span class="params">selector, callback</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> $selector = $(selector);</span><br><span class="line">    <span class="keyword">var</span> _IE = (<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> v = <span class="number">3</span>,</span><br><span class="line">            div = <span class="built_in">document</span>.createElement(<span class="string">'div'</span>),</span><br><span class="line">            all = div.getElementsByTagName(<span class="string">'i'</span>);</span><br><span class="line">        <span class="keyword">while</span> (</span><br><span class="line">            div.innerHTML = <span class="string">'&lt;!--[if gt IE '</span> + (++v) + <span class="string">']&gt;&lt;i&gt;&lt;/i&gt;&lt;![endif]--&gt;'</span>,</span><br><span class="line">            all[<span class="number">0</span>]</span><br><span class="line">        );</span><br><span class="line">        <span class="keyword">return</span> v &gt; <span class="number">4</span> ? v : <span class="literal">false</span>;</span><br><span class="line">    &#125;)();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (_IE &amp;&amp; _IE &lt; <span class="number">9</span>) &#123;</span><br><span class="line">        $selector.on(<span class="string">'propertychange'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="built_in">window</span>.event.propertyName === <span class="string">'value'</span> &amp;&amp; callback.call(<span class="keyword">this</span>);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        $selector.on(<span class="string">'input'</span>, callback);</span><br><span class="line">        <span class="keyword">if</span> (_IE === <span class="number">9</span>) &#123;</span><br><span class="line">            <span class="keyword">var</span> callbackWrapper = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">                callback.call($selector[<span class="number">0</span>]);</span><br><span class="line">            &#125;</span><br><span class="line">            $selector.on(<span class="string">'focus'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">                <span class="built_in">document</span>.addEventListener(<span class="string">'selectionchange'</span>, callbackWrapper);</span><br><span class="line">            &#125;).on(<span class="string">'blur'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">                <span class="built_in">document</span>.removeEventListener(<span class="string">'selectionchange'</span>, callbackWrapper);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="u501F_u52A9_u9690_u85CF_u7684textarea_u7684_u6EDA_u52A8_u6761_u9AD8_u5EA6"><a href="#u501F_u52A9_u9690_u85CF_u7684textarea_u7684_u6EDA_u52A8_u6761_u9AD8_u5EA6" class="headerlink" title="借助隐藏的textarea的滚动条高度"></a>借助隐藏的textarea的滚动条高度</h3><p>html</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">div</span> <span class="attribute">id</span>=<span class="value">"container"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">textarea</span> <span class="attribute">id</span>=<span class="value">"text"</span>&gt;</span><span class="tag">&lt;/<span class="title">textarea</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">textarea</span> <span class="attribute">id</span>=<span class="value">"shadow"</span>&gt;</span><span class="tag">&lt;/<span class="title">textarea</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>css</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="id">#container</span> <span class="rules">&#123;</span><br><span class="line">    <span class="rule"><span class="attribute">position</span>:<span class="value"> relative</span></span>;</span><br><span class="line">&#125;</span></span><br><span class="line"><span class="tag">textarea</span> <span class="rules">&#123;</span><br><span class="line">    <span class="rule"><span class="attribute">width</span>:<span class="value"> <span class="number">200px</span></span></span>;</span><br><span class="line">    <span class="rule"><span class="attribute">height</span>:<span class="value"> <span class="number">100px</span></span></span>;</span><br><span class="line">    <span class="rule"><span class="attribute">min-height</span>:<span class="value"> <span class="number">100px</span></span></span>;</span><br><span class="line">    <span class="rule"><span class="attribute">overflow</span>:<span class="value"> hidden</span></span>; <span class="comment">/* 隐藏IE滚动条 */</span></span><br><span class="line">&#125;</span></span><br><span class="line"><span class="id">#shadow</span> <span class="rules">&#123;</span><br><span class="line">    <span class="rule"><span class="attribute">position</span>:<span class="value"> absolute</span></span>;</span><br><span class="line">    <span class="rule"><span class="attribute">top</span>:<span class="value"> <span class="number">0</span></span></span>;</span><br><span class="line">    <span class="rule"><span class="attribute">left</span>:<span class="value"> <span class="number">0</span></span></span>;</span><br><span class="line">    <span class="rule"><span class="attribute">visibility</span>:<span class="value"> hidden</span></span>;</span><br><span class="line">&#125;</span></span><br></pre></td></tr></table></figure>
<p>javascript</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> $shadow = $(<span class="string">'#shadow'</span>);</span><br><span class="line"><span class="keyword">var</span> paddingTop = <span class="built_in">parseFloat</span>($shadow.css(<span class="string">'padding-top'</span>));</span><br><span class="line"><span class="keyword">var</span> paddingBottom = <span class="built_in">parseFloat</span>($shadow.css(<span class="string">'padding-bottom'</span>));</span><br><span class="line">bindTextChange(<span class="string">'#text'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> $<span class="keyword">this</span> = $(<span class="keyword">this</span>);</span><br><span class="line">    $shadow.val($<span class="keyword">this</span>.val());</span><br><span class="line">    $<span class="keyword">this</span>.height($shadow[<span class="number">0</span>].scrollHeight - paddingTop - paddingBottom);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>实现的原理是增加一个<code>visibility: hidden;</code>的textarea，再通过绝对定位和我们进行输入的textarea重合在一起，通过监听输入事件，将此时显示的textarea中的内容拷贝到隐藏的textarea中，此时隐藏的textarea出现滚动条，接下来将这个滚动条高度设置给显示的textarea的高度，就可以实现自适应高度了，这里面要注意两个问题：</p>
<ol>
<li>隐藏的textarea滚动条的高度，需要减掉上下padding，再赋值给显示的textarea的高度，如果不设置，第一次输入的时候，textarea会突然变长一小块</li>
<li>需要为textarea设置<code>min-height</code>，值同<code>height</code>相同即可，如果不设置，ie8中textarea在输入后，会立刻变成单行文本的高度</li>
</ol>
<h3 id="u501F_u52A9_u81EA_u8EAB_u7684_u6EDA_u52A8_u6761_u9AD8_u5EA6"><a href="#u501F_u52A9_u81EA_u8EAB_u7684_u6EDA_u52A8_u6761_u9AD8_u5EA6" class="headerlink" title="借助自身的滚动条高度"></a>借助自身的滚动条高度</h3><p>html</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">textarea</span>&gt;</span><span class="tag">&lt;/<span class="title">textarea</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>css</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="tag">textarea</span> <span class="rules">&#123;</span><br><span class="line">    <span class="rule"><span class="attribute">width</span>:<span class="value"> <span class="number">200px</span></span></span>;</span><br><span class="line">    <span class="rule"><span class="attribute">height</span>:<span class="value"> <span class="number">100px</span></span></span>;</span><br><span class="line">    <span class="rule"><span class="attribute">min-height</span>:<span class="value"> <span class="number">100px</span></span></span>;</span><br><span class="line">    <span class="rule"><span class="attribute">overflow</span>:<span class="value"> hidden</span></span>;</span><br><span class="line">&#125;</span></span><br></pre></td></tr></table></figure>
<p>javascript</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> $textarea = $(<span class="string">'textarea'</span>);</span><br><span class="line"><span class="keyword">var</span> paddingTop = <span class="built_in">parseFloat</span>($textarea.css(<span class="string">'padding-top'</span>));</span><br><span class="line"><span class="keyword">var</span> paddingBottom = <span class="built_in">parseFloat</span>($textarea.css(<span class="string">'padding-bottom'</span>));</span><br><span class="line"><span class="keyword">var</span> minHeight = <span class="built_in">parseFloat</span>($textarea.css(<span class="string">'min-height'</span>));</span><br><span class="line">bindTextChange(<span class="string">'textarea'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    $(<span class="keyword">this</span>).height(minHeight).height(<span class="keyword">this</span>.scrollHeight - paddingTop - paddingBottom);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>其实这种方法实现的原理和第一种方法基本是一致的，都是根据textarea的<code>scrollHeight</code>来设置<code>height</code>以达到高度自适应的效果，不同的是这种方法不需要新增一个textarea，而是先将自己的高度设置为最小高度，获得此时滚动条的高度，再根据它设置高度。</p>
<h3 id="u501F_u52A9_u9690_u85CF_u7684pre_u6807_u7B7E"><a href="#u501F_u52A9_u9690_u85CF_u7684pre_u6807_u7B7E" class="headerlink" title="借助隐藏的pre标签"></a>借助隐藏的pre标签</h3><p>html</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">pre</span>&gt;</span><span class="tag">&lt;<span class="title">span</span>&gt;</span><span class="tag">&lt;/<span class="title">span</span>&gt;</span><span class="tag">&lt;<span class="title">br</span>&gt;</span><span class="tag">&lt;/<span class="title">pre</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">textarea</span>&gt;</span><span class="tag">&lt;/<span class="title">textarea</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>css</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="tag">div</span> <span class="rules">&#123;</span><br><span class="line">    <span class="rule"><span class="attribute">position</span>:<span class="value"> relative</span></span>;</span><br><span class="line">    <span class="rule"><span class="attribute">width</span>:<span class="value"> <span class="number">200px</span></span></span>;</span><br><span class="line">&#125;</span></span><br><span class="line"><span class="tag">pre</span> <span class="rules">&#123;</span><br><span class="line">    <span class="rule"><span class="attribute">display</span>:<span class="value"> block</span></span>;</span><br><span class="line">    <span class="rule"><span class="attribute">min-height</span>:<span class="value"> <span class="number">100px</span></span></span>;</span><br><span class="line">    <span class="rule"><span class="attribute">margin</span>:<span class="value"> <span class="number">0</span></span></span>;</span><br><span class="line">    <span class="rule"><span class="attribute">visibility</span>:<span class="value"> hidden</span></span>;</span><br><span class="line">&#125;</span></span><br><span class="line"><span class="tag">textarea</span> <span class="rules">&#123;</span><br><span class="line">    <span class="rule"><span class="attribute">position</span>:<span class="value"> absolute</span></span>;</span><br><span class="line">    <span class="rule"><span class="attribute">top</span>:<span class="value"> <span class="number">0</span></span></span>;</span><br><span class="line">    <span class="rule"><span class="attribute">left</span>:<span class="value"> <span class="number">0</span></span></span>;</span><br><span class="line">    <span class="rule"><span class="attribute">width</span>:<span class="value"> <span class="number">100%</span></span></span>;</span><br><span class="line">    <span class="rule"><span class="attribute">height</span>:<span class="value"> <span class="number">100%</span></span></span>;</span><br><span class="line">    <span class="rule"><span class="attribute">overflow</span>:<span class="value"> hidden</span></span>;</span><br><span class="line">&#125;</span></span><br></pre></td></tr></table></figure>
<p>javascript</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> $span = $(<span class="string">'pre span'</span>);</span><br><span class="line">bindTextChange(<span class="string">'textarea'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    $span.html($(<span class="keyword">this</span>).val());</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>这个方法借助特定的html结构巧妙的实现了textarea自适应高度。为textarea包裹一层父元素，同时设置它为绝对定位并且height为100%，再在父元素下添加一个pre标签，这些的结构可以通过改变pre标签的高度来改变父元素的高度从而间接改变textarea的高度,为什么偏偏要用pre标签，那是因为pre标签可以保留换行符，因此我们只要监听textarea的文本变化，并将文本值设置给pre标签即可，那为什么还有一个<code>&lt;br&gt;</code>，那是因为要预先保留一行，如果没有它，在增大textarea高度的时候会出现第一行文本先隐藏再出现的Bug。<br>另外这种方法只支持IE9以上的版本。</p>
</div></article></div></section><footer><div class="paginator"><a href="/2015/12/24/es6InSublime/" class="prev">上一篇</a><a href="/2015/11/28/textChange/" class="next">下一篇</a></div><div id="disqus_thread"></div><script>var disqus_shortname = 'fedviccom';
var disqus_identifier = '2015/11/29/textareaAutosize/';
var disqus_title = '让textarea高度随输入自适应';
var disqus_url = 'http://fedvic.com/2015/11/29/textareaAutosize/';
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//fedviccom.disqus.com/count.js" async></script><div class="copyright"><p>© 2015 - 2016 <a href="http://fedvic.com">vic</a>, unless otherwise noted.</p></div></footer><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-65933410-1",'auto');ga('send','pageview');</script><script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "//hm.baidu.com/hm.js?a36e15d9e2adec9a21fcdd9f686b1ed2";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script><script src="https://cdn.bootcss.com/mathjax/2.5.3/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script></body></html>